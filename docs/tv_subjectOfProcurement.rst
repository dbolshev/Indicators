.. _tv_subjectOfProcurement:

=======================
tv_subjectOfProcurement
=======================

**************************
Суть транзакційної змінної
**************************

Ця транзакційна змінна відображає предмет закупівлі у процедурі віповідно до `наказу МЕРТ №454 <http://zakon0.rada.gov.ua/laws/show/z0448-16>`_, згідно з Єдиним закупівельним словником.

*********************
Об'єкт характеристики
*********************

Дана транзакційна змінна характеризує *процедуру (тендер)*.

***************************
Форма транзакційної змінної
***************************

Транзакційна змінна кожній процедурі (тендеру) ставить у відповідніть код предмета закупівлі відповідно до Єдиного закупівельного словника.

У таблиці наведено приклад того, як саме виглядає транзакційна змінна.

======== =======================
Тендер   tv_subjectOfProcurement
-------- -----------------------
Тендер 1 32310000-9
Тендер 2 31610000-5
...      ...
======== =======================

********************************
Розрахунок транзакційної змінної
********************************

Джерела даних для розрахунку
============================

Для розрахунку індикатора вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``data.items``
- ``data.items.classification.id``

Формула розрахунку
==================

Поняття батьківскького коду
-----------------------------

Єдиний закупівельний словник має деревоподібну структуру. Усі коди єдиного закупівельного словника, деталізовані до 3 цифр або більше, мають батьківський код (коди, деталізовані до 2 цифр, є коренями дерева). Наприклад, код 31610000-5 має батьківський код 31600000-2. А код 31000000-6 не має батьківського коду, оскільки він є кореневим.

Декілька різних кодів можуть мати спільний батьківський код. Наприклад, коди 45100000-8 і 45200000-9 мають спільний батьківський код 45000000-7.

Алгоритм розрахунку транзакційної змінної
-----------------------------------------

1. Для всіх об'єктів ``data.items`` визначити найдовший спільний батьківський код відповідно до поля ``data.items.classification.id``

2. Визначити категорію закупівлі за найдовшим спільним батьківським кодом відповідно до :ref:`порядку визначення<gsw_formula>`

3. У випадку, коли найдовший спільний батьківський код відповідає предмету закупівлі *робіт*:

    а) Якщо найдовший спільний батьківський код деталізований до 6 цифри або більше, то 
    необхідно взяти батьківський код цього коду, деталізований до 5 цифри

    б) Якщо найдовший спільний батьківський код деталізований до 5 цифри або менше, то цей код 
    береться без змін

4. У випадку, коли найдовший спільний батьківський код відповідає предмету закупівлі *товарів* або *послуг*:

    а) Якщо найдовший спільний батьківський код починається на 3361, 3362, 3363, 3364, 3365, 
    3366, 3367, 33691, 33692, то:
        
        а.1) Якщо найдовший спільний батьківський код деталізований до 4 цифри або більше, то 
        необхідно взяти батьківський код цього коду, деталізований до 3 цифри

        а.2) Якщо найдовший спільний батьківський код деталізований до 3 цифри або менше, то цей 
        код береться без змін

    б) Якщо найдовший спільний батьківський код починається на цифри, що не входять до переліку
    з пункту *а)*, то:

        б.1) Якщо найдовший спільний батьківський код деталізований до 5 цифри або більше, то 
        необхідно взяти батьківський код цього коду, деталізований до 4 цифри

        б.2) Якщо найдовший спільний батьківський код деталізований до 4 цифри або менше, то цей 
        код береться без змін

5. Отриманий код є кодом предмету закупівлі та значенням транзакційної змінної