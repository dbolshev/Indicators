.. _tbl_oneBidderForCPV4:

====================
tbl_oneBidderForCPV4
====================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає, хто вигравав процедури Замовника за групами кодів CPV4.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовника

- Ідентифікатор постачальника

- Група ідентифікаторів CPV4

Приклад того, як може виглядати аналітична таблиця:

========== ============== ======
Замовник   Постачальник   CPV4   
---------- -------------- ------
Замовник 1 Постачальник 1 CPV4 1
Замовник 1 Постачальник 2 CPV4 1
Замовник 1 Постачальник 3 CPV4 2
Замовник 2 Постачальник 1 CPV4 1
Замовник 2 Постачальник 2 CPV4 2
...        ...            ...
========== ============== ======

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.awards.suppliers.identifier.scheme``
- ``data.awards.suppliers.identifier.id``
- ``data.awards.status``
- ``data.procuringEntity.identifier.scheme``
- ``data.procuringEntity.identifier.id``
- ``data.items.classification.id``
- ``data.awards.lotID``
- ``data.items.relatedLot``


Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``aboveThresholdUA``, ``aboveThresholdEU``. Процедури повинні бути завершені, тобто ``data.status = 'complete'``

3. Для кожної процедури визначаємо її замовника (конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``).
   Також для процедури визначаємо усіх її переможців (конкатенація ``data.awards.suppliers.identifier.scheme`` та ``data.awards.suppliers.identifier.id``) в тих об'єктах, де ``data.awards.status = 'active'``.
   
4. Для кожного переможця знаходимо ``cpv`` продукції, що він хоче поставляти, тобто ``data.items.classification.id``, на які посилаються ``data.awards.lotID = data.items.relatedLot``.
   Для кожного ``cpv`` знаходимо ``cpv4``, тобто беремо перші 4 цифри з ``cpv`` та додаємо "0000".
   
5. Групуємо дані по Замовнику (конкатенація ``data.procuringEntity.identifier.scheme`` та ``data.procuringEntity.identifier.id``), CPV4 та Учаснику (конкатенація ``data.awards.suppliers.identifier.scheme`` та ``data.awards.suppliers.identifier.id``).
   Отримані рядки заносимо у таблицю.
 
