########################################################################################
RISK2-1П. Застосування переговорної процедури закупівлі (попередньо двічі відмінено торги через відсутність достатньої кількості учасників) із збільшенням очікуваної вартості [та кількості ] закупівлі більше ніж на [30%/40%/50%] ДПА: (В переговорній процедурі закупівлі (причина двічі відмінені торги) замовник значним чином (більше [10%]) змінив кількість товару який закупає, при чому очікувана вартість не змінюється, або змінена не суттєво (менше 10%)).
########################################################################################

***************
Суть індикатора
***************

Індикатор свідчить про: 
Замовник обрав проведення переговорної процедури закупівлі згідно з п.4 ч.2 ст.35 Закону, та  попередньо:
1) Відмінив двічі тендер (предмет закупівлі та сума очікуваної вартості аналогічні до переговорної процедури закупівлі) через відсутність достатньої кількості учасників - при чому кількість товарів які необхідно закупити була змінена вже в переговорній процедурі; 
2) Таким чином замовник оголосив відкриті тогрги на закупівлю товарів або послуг та візначив кількість товару та очікувану вартість яка не формує ринкову ціну за одиницю. Дана ситуація не привабила реальніх участників та торги не відбулися двічі. 
3) В переговорній процедурі, замовник змінив кількість товару (зміна кількості товару не корелює зміні очікуваної вартості) та уклав договір зі зручним замовником. 

************************************
Законодавче обґрунтування індикатора
************************************

Стаття 35. Умови застосування переговорної процедури закупівлі
частина 2. Переговорна процедура закупівлі застосовується замовником як виняток у разі:
пункт 4) якщо замовником було двічі відмінено тендер через відсутність достатньої кількості учасників, при цьому предмет закупівлі, його технічні та якісні характеристики, а також вимоги до учасника не повинні відрізнятися від вимог, що були визначені замовником у тендерній документації;

********************************
Підстава для розробки індикатора
********************************



*********************************
Методологія та алгоритм розрахунку індикатора
*********************************

Рівень розрахунку
=================
Індикатор розраховується для переговорних процедур на рівні *тендера*.

Джерела даних для розрахунку
============================

Для розрахунку індикатора використовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель
- Таблиця розрахункових даних для активних переговорних процедур на дату розрахунку індикатора. Зібрані розрахункові дані включать: предмет закупівлі відповідно до транзакційної змінної :ref:`tv_tenderCPVList` та ідентивікатор замовника відповідно до транзакційної змінної :ref:`tv_procuringEntity`

- Аналітична таблиця :ref:`tbl_unsuccessfulAbove` відмінених (неуспішних) тендерних процедур для всих замовників, які ініціюють переговорну процедуру (активний статус) на дату розрахунку. Відмінені (неуспішні) процедури відбираються наступним чином - пошук відмінених процедур здійснюються для замовника за період в зворотньому напрямку від дати ініціації переговорної процедури на яку розраховується індикатор до першої попередньої переговорної процедури, якщо попорередньої процедури в проміжку 365 днів не знайдено, таким чином пошук процедур відбувається за період 365 днів від дати переговорної процедури яка досліджується.

Типи процедур
=============

Індикатор розраховується для наступних типів процедур:

- ``negotiation`` - *переговорна процедура*
- ``negotiation.quick`` - *прискорена переговорна процедура*


Причина проведення переговорної процедури
-----------------------------------------
До розрахунку беруться процедури, в яких причина ``data.cause`` вказана як ``twiceUnsuccessful``, тобто "двічі відмінена відкрита процедура".

Типи замовників
===============

Індикатор розраховується для замовників які в системі визначені як "А — Замовник (загальний)"  -  (``general``) та "В — Замовник (спеціальний)"  -  (``special``).

Стадії процедур
===============

Подія, що вмикає розрахунок індикатора
--------------------------------------

Подія, що вмикає розрахунок індикатора - перехід процедури у статус ``active``

Подія, що вимикає розрахунок індикатора
---------------------------------------

Розрахунок індикатора вимикається одразу після того, як останнє його розраховане значення дорівнює ``0`` чи ``1``.

Статуси процедур
----------------

Виходячи з подій, що вмикають та вимикають розрахунок індикатора, маємо наступні умови розрахунку:

- Індикатор розраховується для даної процедури для наступного статусу:
  - ``active``.

Частота розрахунку
==================

Індикатор розраховується при кожній зміні json-документу, що відповідає процедурі, якщо присутні усі умови для його розрахунку. Також індикатор розраховується один раз на добу, незалежно від змін у документі, якщо присутні усі умови для його розрахунку.

Поля для розрахунку
===================

Для розрахунку індикатора використовуються наступні поля з API модуля тендеринга:

- ``value:amount``
- ``items:quantity``
- ``items:unit:quantity``
- ``data.cause``
- ``data.contracts``
- ``data.contracts.status``

Для розрахунку індикатора використовуються наступні транзакційні змінні:

- :ref:`tv_tenderCPVList`
- :ref:`tv_procuringEntity`

Для розрахунку індикатора використовуються наступні аналітичні таблиці:

- :ref:`tbl_unsuccessfulAbove`

Формула розрахунку
==================

Якщо в json-документі, що відповідає процедурі, відсутній блок ``data.contracts``, де хоча б в одного об'єкту виконується ``data.contracts.status = 'pending'``, індикатор приймає значення ``-2``.

Zкщо в json-документі, що відповідає процедурі, присутній блок ``data.contracts``, де хоча б в одного об'єкту виконується ``data.contracts.status = 'pending'``, переходимо на наступний крок.

Індикатор розраховується наступним чином:

Індикатор розраховується для поцедур в яких ``value:amount`` більше встановлених законом порогів

Алгоритм спочтку генерує інформацію яка необхідна для розрахунку індикатора в аналітичні таблиці за один операційний день що минув. 

1. Для замовника який здійснює переговорну процедуру з причини двох неуспішних відкритох процедур:ref:`tv_procuringEntity` та предмета закупівлі або частин предмету закупівлі:ref:`tv_tenderCPVList` у аналітичній таблиці :ref:`tbl_unsuccessfulAbove` шукається дві неуспішні відкриті процедури від дати переговорної процедури, яка аналізується, до дати попередньої переговорної процедури цього замовника по цьому (або частин) предмету закупівлі. Якщо в проміжку від дати переговорної процедури на протязі 365 днів не відбувалися переговорні процедури цього замовника, пошук відповідної кількості неуспішних відкритих процедур по томуж предемету закупівлі здійснюється в проміжок 365 днів.

2. Індикатор розраховується для тих переговорних процедур, для яких знайдено у аналітичній таблиці дві неуспішні відкриті процедур замовника по аналогічному предмету закупівлі (або частини предмету закупівлі).

3. Якщо знайдена у аналітичній таблиці кількість неуспішних відкритих процедур замовника по аналогічному предмету закупівлі (або частин предмету закупівлі) рівно 2.  Здійснюеться порівняня ``items:quantity`` у переговорній процедурі по відповідному CPV з ``items:quantity``  в останній неуспішній відкритій процедурі; та здійснюється порівняня ``value:amount`` у переговорній процедурі по відповідному CPV з ``value:amount`` в останній неуспішній відкритій процедурі. Якщо різниці між ``items:quantity`` більше 10% а різниці в ``value:amount`` менше 10% то індикатор приймає значення 1. Якщо умова не виконується то індикатор приймає значення 0. 

Фактори, що впливають на неточність розрахунку
==============================================

1. Індикатор може бути спрацьований некоректно у випадках, коли юридичні особи, які не є замовниками в розумінні Закону, але є державними, комунальними, казенними підприємствами, господарськими товариствами чи об'єднаннями підприємств, в яких державна чи комунальна частка складає 50 і більше відсотків  помилково визначають себе в системі як загальні замовники. Така ситуація відбувається з причини, що за чинними нормативними актами, замовник при ініціюванні процедури закупівлі самостійно у полі "тип замовника" себе визначає. При цьому, з боку системи чи авторизованих майданчиків не здійснюється контроль за достовірність такого визначення. Таким чино індикатор спрацьовує на тих процедурах які в системі зазначено як замовник - загальний, а по факту замовник належить ло категорії "інші".
