.. _tbl_monopolyCPV4:

================
tbl_monopolyCPV4
================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає групи кодів CPV4, за якими на ринку є 3 чи менше постачальників.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

_ Ідентифікатор групи товарів CPV4


Приклад того, як може виглядати аналітична таблиця:

====== ======
CPV4   
------ ------
cpv4 1 
cpv4 2 
cpv4 3 
cpv4 4 
cpv4 5 
...    ...
====== ======

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.procurementMethodType``

- ``data.status``

- ``data.bids.status``

- ``data.items.classification.id``

- ``data.bids.tenderers.identifier.scheme``

- ``data.bids.tenderers.identifier.id``



Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``aboveThresholdUA``, ``aboveThresholdEU``. Процедури повинні бути завершені, тобто ``data.status = 'complete'``

3. Для кожної процедури знаходимо її ``cpv``. Для однолотової процедури він буде дорівнювати ``data.items.classification.id``. Якщо процедура багатолотова, то робимо наступним чином. Для кожного об'єкту ``data.items`` знаходимо ``data.items.classification.id``. Потім беремо найдовшу послідовність цифр (зліва направо), що співпадає в усіх об'єктах. Доповнюємо цю комбінацію цифр праворуч "0" так, щоб вийшло 8 цифр. Це буде cpv багатолотової процедури.

4. Знаходимо cpv4 для кожного cpv - беремо перші 4 цифри від cpv та додаємо до них "0000".

5. Знаходимо ідентифікатори усіх учасників процедури - пари ``data.bids.tenderers.identifier.scheme`` та ``data.bids.tenderers.identifier.id`` для об'єктів, для яких ``data.bids.status = 'active'``.

6. Групуємо дані по ``cpv4``, збираючи у список усі унікальні ідентифікатори учасників.

7. Заносимо в таблицю ті ``cpv4``, для яких список унікальних учасників складає 3 або менше елемента.



