.. _tbl_nearThreshold:

=================
tbl_nearThreshold
=================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає, чи проводив Замовник протягом поточного року закупівлі, що близькі до порогу 200К (general) та 1М (special) для товарів та послуг, або 1.5М(general) та 5М (special) для робіт.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовника

Приклад того, як може виглядати аналітична таблиця:

========== ==
Замовник
---------- --
Замовник 1
Замовник 2
Замовник 3
Замовник 4
Замовник 5
...
========== ==

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель

- Визначення *товарів*, *послуг* чи *робіт* на основі транзакційної змінної :ref:`tv_subjectOfProcurement` та :ref:`порядку визначення категоріі закупівлі за кодом Єдиного закупівельного словника<gsw_formula>`.

- `API курсу валют Національного Банку України <https://bank.gov.ua/control/uk/publish/article?art_id=38441973#exchange>`_


Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.procuringEntity.identifier.id``

- ``data.procurementMethodType``

- ``data.status``

- ``data.tenderID``

- ``data.value``

- ``data.value.amount``

- ``data.value.currency``

- ``data.tenderPeriod.startDate``

- ``data.date``

Для розрахунку індикатора використовуються наступні транзакційні змінні:

- :ref:`tv_subjectOfProcurement`

Для розрахунку індикатора використовуються наступні поля з API курсу валют Національного Банку України:

- ``cc``

- ``rate``

- ``exchangedate``

Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``belowThreshold``, ``reporting``. Процедури повинні бути завершені, тобто ``data.status = 'complete'``. 

3. Процедури мають бути поточного року.

3.а) Для ``data.procurementMethodType = 'belowThreshold'`` ``data.tenderPeriod.startDate`` має бути поточного року.

3.б) Для ``data.procurementMethodType = 'reporting'`` ``data.date`` має бути поточного року.

4. Для ``data.procurementMethodType = 'reporting'`` ``data.date`` має бути ранішою на 3 дні від дати розрахунку.

5. Визначається дата створення тендера шляхом перетворення в дату 10 символів починаючи з 4-го з ``data.tenderID``. Нехай це буде "Дата оголошення"

6. До уваги беремо процедури, що оголошені у поточному році.

7. Перевіряється валюта, в якій вказана очікувана вартість процедури відповідно до поля ``data.value.currency``

  7.а) Якщо очікувана вартість указана в гривнях, тобто ``data.value.currency = 'UAH'``, то вона залишається без змін.

  7.б) Якщо очікувана вартість указана не в гривнях, то вона переводиться у гривні відповідно до курсу даної валюти до гривні за допомогою API курсу валют на "Дату оголошення".

8. Якщо закупівлю проводить загальний замовник (general)

  8.а) Якщо очікувана вартість в гривнях перевищує 190000 (сто дев'яносто тисяч) і менше 200000 (двісті тисяч), та проводиться закупка *товарів* чи *послуг*, то ``data.procuringEntity.identifier.id`` заноситься в таблицю.
  
  8.б) Якщо очікувана вартість *в гривнях* перевищує 1350000 (один мільйон триста п'ятдесят тисяч) і менше 1500000 (один мільйон п'ятьсот тисяч), та проводиться закупка *робіт*, то ``data.procuringEntity.identifier.id`` заноситься в таблицю.
  
9. Якщо закупівлю проводить замовник, що здійснює діяльність в окремих сферах господарювання (``special``)

  9.а) Якщо очікувана вартість в гривнях перевищує 950000 (дев'ятьсот п'ятдесят тисяч) і менше 1000000 (один мільйон), та проводиться закупка *товарів* чи *послуг*, то ``data.procuringEntity.identifier.id`` заноситься в таблицю.  
  
  9.б) Якщо очікувана вартість *в гривнях* перевищує 4500000 (чотири мільйона п'ятьсот тисяч) і менше 5000000 (п'ять мільйонів), та проводиться закупка *робіт*, то ``data.procuringEntity.identifier.id`` заноситься в таблицю.
  
