.. _tbl_meanStdOfBuyerByCPV4:

========================
tbl_meanStdOfBuyerByCPV4
========================

************************
Суть аналітичної таблиці
************************

Дана аналітична таблиця відображає середнє значення (mean) та стандартне відхилення (standard deviation) по процедурах Замовника по групах кодів CPV4.

*************************
Форма аналітичної таблиці
*************************

Аналітична таблиця містить наступну інформацію:

- Ідентифікатор замовника

- Ідентифікатор групи кодів CPV4

- Середнє значення очікуваної вартості процедури

- Стандартне відхилення очікуваної вартості процедури

Приклад того, як може виглядати аналітична таблиця:

========== ====== ====== =====
Замовник   CPV4   Mean   Std
---------- ------ ------ -----
Замовник 1 CPV4 1 Mean 1 Std 1
Замовник 1 CPV4 2 Mean 2 Std 2
Замовник 1 CPV4 3 Mean 3 Std 3
Замовник 2 CPV4 4 Mean 4 Std 4
Замовник 2 CPV4 5 Mean 5 Std 5
...        ...    ...    ...
========== ====== ====== =====

******************************
Розрахунок аналітичної таблиці
******************************

Джерела даних для розрахунку
============================

Для розрахунку аналітичної таблиці вікористовуються наступні джерела даних:

- API модуля тендеринга електронної системи закупівель


Частота розрахунку
==================

Аналітична таблиця розраховується раз на добу.

Поля для розрахунку
===================

Для розрахунку використовуються наступні поля з API модуля тендеринга:

- ``data.procuringEntity.identifier.id``

- ``data.procuringEntity.identifier.scheme``

- ``data.value.amount``

- ``data.status``

- ``data.procurementMethodType``


Формула розрахунку
==================

1. Перед розрахунком аналітична таблиця очищується.

2. До уваги беруться усі процедури, у яких ``data.procurementMethodType`` мають бути ``belowThreshold``, ``aboveThresholdUA``, ``aboveThresholdEU``, ``reporting``, ``negotiation``, ``negotiation.quick``. Процедури повинні бути завершені, тобто ``data.status = 'complete'``

3. Для кожної процедури визначаємо її Замовника (конкатенація ``data.procuringEntity.identifier.id`` та ``data.procuringEntity.identifier.scheme``).

4. Для кожної процедури визначаємо її очікувану вартість ``data.value.amount``.

5. Знаходимо ``cpv`` процедури. Якщо процедура однолотова, то її ``cpv = data.items.classification.id``.
   Якщо процедура багатолотова, торобимо наступним чином. Для кожного об'єкту ``data.items`` знаходимо ``data.items.classification.id``. Потім беремо найдовшу послідовність цифр (зліва направо), що співпадає в усіх об'єктах. Доповнюємо цю комбінацію цифр зправа "0" так, щоб вийшло 8 цифр. Це буде ``cpv`` багатолотового тендера.
   
6. Знаходимо ``cpv4`` процедури. Беремо перші 4 цифри ``cpv`` та додаємо зправа "0000".

7. Групуємо дані за Замовником та його ``cpv4``, знаходячи для очікуваних вартостей процедур середнє значення (mean) та стандартне відхилення (standard deviation).

8. З результатів робимо нашу таблицю.
